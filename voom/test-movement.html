<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOOM Movement Test</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: monospace;
            background: #111;
            color: #0f0;
        }
        #status {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 10px;
            border: 1px solid #0f0;
            z-index: 1000;
        }
        #test-area {
            margin-top: 100px;
            padding: 20px;
            border: 2px solid #0f0;
            min-height: 200px;
        }
        .key-state {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            border: 1px solid #0f0;
            background: rgba(0, 255, 0, 0.1);
        }
        .key-state.active {
            background: rgba(0, 255, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="status">
        <h2>Movement Input Debugger</h2>
        <div>
            <h3>Hotkeys-js Status:</h3>
            <div id="hotkeys-status"></div>
        </div>
        <div>
            <h3>Raw Keyboard Events:</h3>
            <div id="raw-status"></div>
        </div>
        <div>
            <h3>Current Keys:</h3>
            <div id="keys">
                <span class="key-state" id="key-w">W</span>
                <span class="key-state" id="key-a">A</span>
                <span class="key-state" id="key-s">S</span>
                <span class="key-state" id="key-d">D</span>
                <span class="key-state" id="key-shift">SHIFT</span>
                <span class="key-state" id="key-up">↑</span>
                <span class="key-state" id="key-left">←</span>
                <span class="key-state" id="key-down">↓</span>
                <span class="key-state" id="key-right">→</span>
            </div>
        </div>
    </div>
    
    <div id="test-area">
        <h3>Test Area - Click here and press keys</h3>
        <p>This tests both hotkeys-js and raw keyboard events</p>
        <div id="log"></div>
    </div>

    <script type="module">
        import hotkeys from 'hotkeys-js';
        
        const log = (msg) => {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.textContent = `[${new Date().toISOString().split('T')[1].split('.')[0]}] ${msg}`;
            logDiv.insertBefore(entry, logDiv.firstChild);
            if (logDiv.children.length > 10) {
                logDiv.removeChild(logDiv.lastChild);
            }
        };

        // Track key states
        const keyStates = {
            w: false, a: false, s: false, d: false,
            shift: false, up: false, left: false, down: false, right: false
        };

        const updateKeyDisplay = (key, state) => {
            const elem = document.getElementById(`key-${key}`);
            if (elem) {
                if (state) {
                    elem.classList.add('active');
                } else {
                    elem.classList.remove('active');
                }
            }
        };

        // Test hotkeys-js
        log('Initializing hotkeys-js test...');
        
        // Configure hotkeys-js
        hotkeys.filter = () => true;
        
        // Try the exact same binding as in InputManager
        hotkeys('w,a,s,d,up,down,left,right,shift', { keydown: true, keyup: true }, (event, handler) => {
            const isKeyDown = event.type === 'keydown';
            const key = handler.key;
            
            log(`[hotkeys-js] ${event.type}: ${key}`);
            document.getElementById('hotkeys-status').textContent = 
                `Last: ${event.type} - ${key} at ${new Date().toISOString().split('T')[1].split('.')[0]}`;
            
            keyStates[key] = isKeyDown;
            updateKeyDisplay(key, isKeyDown);
        });

        // Also test raw keyboard events as fallback
        document.addEventListener('keydown', (e) => {
            const keyMap = {
                'w': 'w', 'W': 'w',
                'a': 'a', 'A': 'a', 
                's': 's', 'S': 's',
                'd': 'd', 'D': 'd',
                'Shift': 'shift',
                'ArrowUp': 'up',
                'ArrowLeft': 'left',
                'ArrowDown': 'down',
                'ArrowRight': 'right'
            };
            
            const mappedKey = keyMap[e.key];
            if (mappedKey) {
                log(`[raw] keydown: ${e.key} (${e.code})`);
                document.getElementById('raw-status').textContent = 
                    `Last keydown: ${e.key} (${e.code}) at ${new Date().toISOString().split('T')[1].split('.')[0]}`;
                keyStates[mappedKey] = true;
                updateKeyDisplay(mappedKey, true);
                e.preventDefault();
            }
        });

        document.addEventListener('keyup', (e) => {
            const keyMap = {
                'w': 'w', 'W': 'w',
                'a': 'a', 'A': 'a',
                's': 's', 'S': 's', 
                'd': 'd', 'D': 'd',
                'Shift': 'shift',
                'ArrowUp': 'up',
                'ArrowLeft': 'left',
                'ArrowDown': 'down',
                'ArrowRight': 'right'
            };
            
            const mappedKey = keyMap[e.key];
            if (mappedKey) {
                log(`[raw] keyup: ${e.key} (${e.code})`);
                document.getElementById('raw-status').textContent = 
                    `Last keyup: ${e.key} (${e.code}) at ${new Date().toISOString().split('T')[1].split('.')[0]}`;
                keyStates[mappedKey] = false;
                updateKeyDisplay(mappedKey, false);
                e.preventDefault();
            }
        });

        // Focus the test area
        document.getElementById('test-area').focus();
        
        log('Ready! Press WASD, arrow keys, or shift to test');
    </script>
</body>
</html>